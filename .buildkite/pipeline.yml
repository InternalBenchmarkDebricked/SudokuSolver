steps:

  - label: ":evergreen_tree: mvn dependency:tree"
    command: mvn dependency:tree -DoutputFile=.debricked-maven-dependencies.tgf -DoutputType=tgf
    plugins:
      - docker#v3.3.0:
          image: maven
          workdir: /app
    artifact_paths: "**/.debricked-maven-dependencies.tgf"
          
  - label: ":shield: Debricked"
    commands:
      - buildkite-agent artifact download "*.debricked-maven-dependencies.tgf" .
    env: 
      REPOSITORY: "${BUILDKITE_REPO}"
      COMMIT: "${BUILDKITE_COMMIT}"
      BRANCH: "${BUILDKITE_BRANCH}"
      AUTHOR: "${BUILDKITE_BUILD_AUTHOR}"
    plugins:
      - docker#v3.3.0:
          image: "debricked/debricked-scan"
          environment: 
              - "DEBRICKED_TOKEN"
              - "INTEGRATION_NAME=BuildKite"
              - "REPOSITORY"
              - "COMMIT"
              - "BRANCH"
              - "AUTHOR"
          entrypoint: ""

